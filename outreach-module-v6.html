<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outreach Module v6 - Production Spec</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --purple-primary: #7848FE;
            --purple-secondary: #9F7BFF;
            --purple-light: #D3B9F9;
            --purple-ultralight: #EADEFC;
            --purple-deep: #280470;
            --purple-dark: #1405D6;
            --peach: #FFD2BB;
            --peach-light: #F9EAE4;
            --grey-50: #FAFAFA;
            --grey-100: #F5F5F7;
            --grey-200: #E8E8ED;
            --grey-300: #D1D1D6;
            --grey-400: #AEAEB2;
            --grey-600: #636366;
            --grey-700: #48484A;
            --grey-900: #1C1C1E;
            --white: #FFFFFF;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px rgba(120, 72, 254, 0.08);
            --shadow-lg: 0 12px 32px rgba(120, 72, 254, 0.12);
            --shadow-xl: 0 20px 48px rgba(120, 72, 254, 0.16);
        }

        body {
            font-family: 'Lato', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #FAFBFC;
            color: var(--grey-900);
            line-height: 1.5;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            overflow: hidden;
        }

        /* App Layout */
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--white);
            border-right: 1px solid var(--grey-200);
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-sm);
        }

        .logo-container {
            padding: 20px;
            border-bottom: 1px solid var(--grey-200);
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--purple-primary), var(--purple-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-subtitle {
            font-size: 11px;
            color: var(--grey-600);
            margin-top: 2px;
        }

        .nav-section {
            padding: 16px 0;
        }

        .nav-label {
            padding: 0 20px 8px;
            font-size: 11px;
            font-weight: 700;
            color: var(--grey-400);
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .nav-item {
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--grey-700);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .nav-item:hover {
            background: var(--grey-50);
            color: var(--purple-primary);
        }

        .nav-item.active {
            background: var(--purple-ultralight);
            color: var(--purple-primary);
            font-weight: 600;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--purple-primary);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: var(--white);
            padding: 16px 32px;
            border-bottom: 1px solid var(--grey-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left h1 {
            font-size: 20px;
            font-weight: 600;
            color: var(--grey-900);
        }

        .header-subtitle {
            font-size: 13px;
            color: var(--grey-600);
            margin-top: 2px;
        }

        .container {
            flex: 1;
            overflow-y: auto;
            padding: 24px 32px;
        }

        h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--grey-900);
            letter-spacing: -0.5px;
        }

        h2 {
            font-size: 18px;
            font-weight: 600;
            color: var(--grey-900);
            margin-bottom: 16px;
            letter-spacing: -0.3px;
        }

        h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--grey-900);
            margin-bottom: 12px;
            letter-spacing: -0.2px;
        }

        .subtitle {
            color: var(--grey-600);
            font-size: 14px;
            margin-top: 4px;
            line-height: 1.5;
        }

        /* Landing Screen */
        .landing-screen {
            display: block;
        }

        .tool-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .tool-card {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--grey-200);
            position: relative;
            overflow: hidden;
        }

        .tool-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--purple-primary), var(--purple-secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tool-card:hover:not(.disabled) {
            border-color: var(--purple-light);
            box-shadow: var(--shadow-xl);
            transform: translateY(-4px);
        }

        .tool-card:hover:not(.disabled)::before {
            opacity: 1;
        }

        .tool-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .tool-card.active {
            border-color: var(--purple-primary);
        }

        .tool-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 12px;
            box-shadow: var(--shadow-sm);
        }

        .tool-icon.voice {
            background: linear-gradient(135deg, var(--purple-secondary), var(--purple-primary));
        }
        .tool-icon.whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
        }
        .tool-icon.sms {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
        }
        .tool-icon.email {
            background: linear-gradient(135deg, #EC4899, #DB2777);
        }

        .tool-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--grey-900);
            letter-spacing: -0.2px;
        }

        .tool-description {
            font-size: 13px;
            color: var(--grey-600);
            margin-bottom: 10px;
            line-height: 1.4;
            font-weight: 400;
        }

        .tool-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-active {
            background: linear-gradient(135deg, #10B981, #059669);
            color: var(--white);
        }

        .badge-coming {
            background: var(--grey-200);
            color: var(--grey-600);
        }

        /* Agent List */
        .agents-section {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--grey-200);
        }

        .agents-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .agents-table {
            width: 100%;
            border-collapse: collapse;
        }

        .agents-table th {
            text-align: left;
            padding: 10px 12px;
            border-bottom: 1px solid var(--grey-200);
            font-weight: 600;
            font-size: 12px;
            color: var(--grey-600);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .agents-table td {
            padding: 14px 12px;
            border-bottom: 1px solid var(--grey-200);
            font-size: 14px;
        }

        .agent-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .agent-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: var(--shadow-sm);
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .status-draft {
            background: var(--grey-200);
            color: var(--grey-600);
        }

        .status-active {
            background: linear-gradient(135deg, #10B981, #059669);
            color: var(--white);
        }

        .status-paused {
            background: linear-gradient(135deg, #F59E0B, #D97706);
            color: var(--white);
        }

        .agent-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: none;
            border: none;
            color: var(--purple-primary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 8px;
            transition: all 0.2s;
            font-family: 'Lato', sans-serif;
        }

        .action-btn:hover {
            background: var(--purple-ultralight);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--grey-600);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* Creation Flow */
        .creation-flow {
            display: none;
        }

        .flow-header {
            background: var(--white);
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--grey-200);
        }

        .flow-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--grey-900);
            letter-spacing: -0.3px;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--grey-600);
            cursor: pointer;
            font-size: 24px;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: var(--purple-ultralight);
            color: var(--purple-primary);
        }

        .progress-wrapper {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--grey-200);
        }

        .progress-bar {
            display: flex;
            position: relative;
            margin-bottom: 0;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 18px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: var(--grey-200);
            z-index: 0;
        }

        .progress-steps {
            display: flex;
            position: relative;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 40px;
            right: 40px;
            height: 2px;
            background: var(--grey-200);
            z-index: 0;
        }

        .progress-line-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--purple-primary), var(--purple-secondary));
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .progress-step {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
            z-index: 1;
        }

        .step-circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--grey-200);
            color: var(--grey-600);
            border: 2px solid var(--grey-50);
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        .progress-step.active .step-circle {
            background: linear-gradient(135deg, var(--purple-primary), var(--purple-secondary));
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .progress-step.completed .step-circle {
            background: var(--purple-light);
            color: var(--white);
        }

        .step-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--grey-600);
            text-align: center;
        }

        .progress-step.active .step-label {
            color: var(--purple-primary);
            font-weight: 600;
        }

        .step-content {
            background: var(--white);
            border-radius: 12px;
            padding: 24px;
            display: none;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--grey-200);
        }

        .step-content.active {
            display: block;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--grey-900);
            font-size: 13px;
            letter-spacing: 0.05px;
        }

        .label-optional {
            color: var(--grey-400);
            font-weight: 400;
        }

        .label-required::after {
            content: '*';
            color: #EF4444;
            margin-left: 4px;
        }

        input[type="text"],
        input[type="tel"],
        textarea,
        select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--grey-200);
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Lato', sans-serif;
            transition: all 0.2s;
            background: var(--white);
            color: var(--grey-900);
        }

        input[type="text"]:focus,
        input[type="tel"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--purple-primary);
            box-shadow: 0 0 0 3px var(--purple-ultralight);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-help {
            display: block;
            font-size: 12px;
            color: var(--grey-600);
            margin-top: 4px;
            line-height: 1.4;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 16px;
            border: 1px solid var(--grey-200);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--white);
        }

        .radio-option:hover {
            border-color: var(--purple-light);
            background: var(--purple-ultralight);
        }

        .radio-option.selected {
            border-color: var(--purple-primary);
            background: var(--purple-ultralight);
            box-shadow: var(--shadow-md);
        }

        .radio-option input[type="radio"] {
            margin-top: 2px;
        }

        .radio-label {
            flex: 1;
        }

        .radio-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--grey-900);
            font-size: 14px;
        }

        .radio-description {
            font-size: 12px;
            color: var(--grey-600);
            line-height: 1.4;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        input[type="range"] {
            flex: 1;
            height: 5px;
            border-radius: 4px;
            background: var(--grey-200);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--purple-primary), var(--purple-secondary));
            cursor: pointer;
            box-shadow: var(--shadow-md);
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--purple-primary), var(--purple-secondary));
            cursor: pointer;
            box-shadow: var(--shadow-md);
            border: none;
        }

        .slider-value {
            min-width: 45px;
            text-align: right;
            font-weight: 600;
            color: var(--purple-primary);
            font-size: 13px;
        }

        .voice-preview {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            padding: 6px 12px;
            background: var(--purple-ultralight);
            border-radius: 6px;
            color: var(--purple-primary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--purple-light);
            transition: all 0.2s;
        }

        .voice-preview:hover {
            background: var(--purple-light);
            border-color: var(--purple-primary);
        }

        /* Template Selection */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .template-card {
            padding: 14px;
            border: 1px solid var(--grey-200);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--white);
        }

        .template-card:hover {
            border-color: var(--purple-light);
            background: var(--purple-ultralight);
        }

        .template-card.selected {
            border-color: var(--purple-primary);
            background: var(--purple-ultralight);
            box-shadow: var(--shadow-md);
        }

        .template-name {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--grey-900);
            font-size: 14px;
        }

        .template-description {
            font-size: 12px;
            color: var(--grey-600);
            line-height: 1.4;
        }

        /* AI Generator */
        .ai-generator {
            background: linear-gradient(135deg, var(--purple-primary) 0%, var(--purple-secondary) 100%);
            border-radius: 12px;
            padding: 20px;
            color: white;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
        }

        .ai-generator h3 {
            color: white;
            margin-bottom: 8px;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: -0.2px;
        }

        .ai-generator p {
            opacity: 0.95;
            line-height: 1.5;
            font-size: 13px;
        }

        .ai-generator textarea {
            background: rgba(255, 255, 255, 0.98);
            border: none;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .generate-btn {
            background: var(--white);
            color: var(--purple-primary);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: 'Lato', sans-serif;
            font-size: 13px;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .generate-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Variable Chips */
        .variable-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .variable-chip {
            background: var(--purple-ultralight);
            color: var(--purple-primary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid var(--purple-light);
            transition: all 0.2s;
        }

        .variable-chip:hover {
            background: var(--purple-light);
            border-color: var(--purple-primary);
            transform: translateY(-1px);
        }

        /* Knowledge Base */
        .kb-section {
            margin-top: 20px;
            padding: 16px;
            background: var(--grey-50);
            border-radius: 8px;
            border: 1px solid var(--grey-200);
        }

        .kb-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .kb-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: var(--white);
            border-radius: 6px;
            border: 1px solid var(--grey-200);
        }

        .upload-btn {
            background: var(--white);
            border: 1px dashed var(--grey-300);
            padding: 10px 16px;
            border-radius: 8px;
            color: var(--purple-primary);
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: 'Lato', sans-serif;
            font-size: 13px;
            transition: all 0.2s;
        }

        .upload-btn:hover {
            border-color: var(--purple-primary);
            background: var(--purple-ultralight);
        }

        /* Extraction Form Builder */
        .extraction-fields {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .extraction-field {
            padding: 16px;
            border: 1px solid var(--grey-200);
            border-radius: 8px;
            background: var(--grey-50);
        }

        .field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .field-number {
            font-weight: 600;
            color: var(--purple-primary);
            font-size: 13px;
        }

        .remove-field-btn {
            background: none;
            border: none;
            color: #EF4444;
            cursor: pointer;
            font-size: 20px;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .remove-field-btn:hover {
            background: #FEE2E2;
        }

        .field-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 12px;
            margin-bottom: 10px;
        }

        .field-options {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 500;
            color: var(--grey-700);
        }

        .add-field-btn {
            background: var(--white);
            border: 1px dashed var(--grey-300);
            padding: 12px;
            border-radius: 8px;
            color: var(--purple-primary);
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Lato', sans-serif;
            font-size: 13px;
            transition: all 0.2s;
        }

        .add-field-btn:hover {
            border-color: var(--purple-primary);
            background: var(--purple-ultralight);
        }

        /* Post-Call Rules */
        .rules-section {
            margin-top: 24px;
        }

        .rule-card {
            padding: 14px;
            border: 1px solid var(--grey-200);
            border-radius: 8px;
            margin-bottom: 12px;
            background: var(--white);
        }

        .rule-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 12px;
            align-items: end;
        }

        /* Test & Activate */
        .test-section {
            background: var(--grey-50);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--grey-200);
        }

        .test-call-box {
            display: flex;
            gap: 10px;
            align-items: end;
        }

        .test-call-box input {
            flex: 1;
        }

        .transcript-box {
            margin-top: 16px;
            padding: 16px;
            background: var(--white);
            border-radius: 8px;
            border: 1px solid var(--grey-200);
            max-height: 300px;
            overflow-y: auto;
        }

        .transcript-entry {
            margin-bottom: 14px;
            padding-bottom: 14px;
            border-bottom: 1px solid var(--grey-200);
        }

        .transcript-entry:last-child {
            border-bottom: none;
        }

        .speaker {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 13px;
        }

        .speaker.agent {
            color: var(--purple-primary);
        }

        .speaker.user {
            color: #10B981;
        }

        .validation-checks {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .check-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: var(--grey-50);
            border-radius: 6px;
            border: 1px solid var(--grey-200);
            font-size: 13px;
        }

        .check-icon {
            font-size: 16px;
        }

        .check-icon.success {
            color: #10B981;
        }

        .check-icon.error {
            color: #EF4444;
        }

        .check-icon.warning {
            color: #F59E0B;
        }

        /* Buttons */
        .btn-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-size: 13px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Lato', sans-serif;
            letter-spacing: 0.1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--purple-primary), var(--purple-secondary));
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            background: var(--grey-300);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--white);
            color: var(--purple-primary);
            border: 1px solid var(--grey-200);
        }

        .btn-secondary:hover {
            background: var(--purple-ultralight);
            border-color: var(--purple-light);
        }

        .btn-success {
            background: linear-gradient(135deg, #10B981, #059669);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-success:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        /* CSV Upload */
        .csv-upload-area {
            border: 1px dashed var(--grey-300);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            margin-top: 12px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--white);
        }

        .csv-upload-area:hover {
            border-color: var(--purple-primary);
            background: var(--purple-ultralight);
        }

        .csv-upload-area.has-file {
            border-color: #10B981;
            background: #ECFDF5;
        }

        .csv-preview {
            margin-top: 12px;
            text-align: left;
        }

        .csv-preview div {
            margin-bottom: 8px;
        }

        .csv-preview strong {
            font-weight: 600;
            color: var(--grey-900);
        }

        .csv-variables {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .csv-variable {
            background: var(--purple-ultralight);
            color: var(--purple-primary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            border: 1px solid var(--purple-light);
        }

        /* Section Titles */
        .section-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--grey-900);
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--grey-200);
        }

        .panel-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--grey-900);
            margin-bottom: 6px;
            letter-spacing: -0.3px;
        }

        .panel-description {
            font-size: 13px;
            color: var(--grey-600);
            margin-bottom: 24px;
            line-height: 1.5;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .mb-16 {
            margin-bottom: 16px;
        }

        .mt-24 {
            margin-top: 24px;
        }

        .text-center {
            text-align: center;
        }

        .text-muted {
            color: var(--grey-600);
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo-container">
                <div class="logo">lillia</div>
                <div class="logo-subtitle">Chronic Care Platform</div>
            </div>

            <div class="nav-section">
                <div class="nav-label">Main</div>
                <div class="nav-item">
                    <div class="nav-icon">üë•</div>
                    <span>Patients</span>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">üìä</div>
                    <span>Dashboard</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-label">Engagement</div>
                <div class="nav-item active">
                    <div class="nav-icon">üì¢</div>
                    <span>Outreach</span>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">üó∫Ô∏è</div>
                    <span>Journey Tracker</span>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">üìã</div>
                    <span>My Tasks</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-label">Settings</div>
                <div class="nav-item">
                    <div class="nav-icon">‚öôÔ∏è</div>
                    <span>Configuration</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <div>
                        <h1>Outreach Module</h1>
                        <div class="header-subtitle">Create and manage AI-powered outreach agents</div>
                    </div>
                </div>
            </div>

            <div class="container">
        <!-- Landing Screen -->
        <div id="landingScreen" class="landing-screen">
            <h2>Choose Your Tool</h2>
            <div class="tool-cards">
                <div class="tool-card active" onclick="startCreation('voice')">
                    <div class="tool-icon voice">üìû</div>
                    <div class="tool-name">Voice Call</div>
                    <div class="tool-description">AI-powered outbound voice calls</div>
                    <span class="tool-badge badge-active">Active</span>
                </div>

                <div class="tool-card disabled">
                    <div class="tool-icon whatsapp">üí¨</div>
                    <div class="tool-name">WhatsApp</div>
                    <div class="tool-description">AI-powered chat via WhatsApp</div>
                    <span class="tool-badge badge-coming">Coming Soon</span>
                </div>

                <div class="tool-card disabled">
                    <div class="tool-icon sms">üì±</div>
                    <div class="tool-name">SMS</div>
                    <div class="tool-description">Template-based message delivery</div>
                    <span class="tool-badge badge-coming">Coming Soon</span>
                </div>

                <div class="tool-card disabled">
                    <div class="tool-icon email">‚úâÔ∏è</div>
                    <div class="tool-name">Email</div>
                    <div class="tool-description">Template-based email campaigns</div>
                    <span class="tool-badge badge-coming">Coming Soon</span>
                </div>
            </div>

            <div class="agents-section">
                <div class="agents-header">
                    <h2>Configured Agents</h2>
                </div>

                <table class="agents-table" id="agentsTable">
                    <thead>
                        <tr>
                            <th>Agent Name</th>
                            <th>Status</th>
                            <th>Last Run</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="agentsTableBody">
                        <!-- Sample data -->
                        <tr>
                            <td>
                                <div class="agent-name">
                                    <div class="agent-icon voice">üìû</div>
                                    <span>Medication Reminder</span>
                                </div>
                            </td>
                            <td><span class="status-badge status-active">ACTIVE</span></td>
                            <td class="text-muted">2 hours ago</td>
                            <td>
                                <div class="agent-actions">
                                    <button class="action-btn">Edit</button>
                                    <button class="action-btn">Duplicate</button>
                                    <button class="action-btn">Pause</button>
                                    <button class="action-btn">Archive</button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="agent-name">
                                    <div class="agent-icon voice">üìû</div>
                                    <span>Appointment Reminder</span>
                                </div>
                            </td>
                            <td><span class="status-badge status-draft">DRAFT</span></td>
                            <td class="text-muted">Never</td>
                            <td>
                                <div class="agent-actions">
                                    <button class="action-btn">Edit</button>
                                    <button class="action-btn">Duplicate</button>
                                    <button class="action-btn">Archive</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Creation Flow -->
        <div id="creationFlow" class="creation-flow">
            <div class="flow-header">
                <div>
                    <div class="flow-title">Create Voice Agent</div>
                    <div class="subtitle">Follow 4 simple steps to create your agent</div>
                </div>
                <button class="close-btn" onclick="closeCreation()">√ó</button>
            </div>

            <div class="progress-bar">
                <div class="progress-step active" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Setup</div>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Prompt</div>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Extraction</div>
                </div>
                <div class="progress-step" data-step="4">
                    <div class="step-circle">4</div>
                    <div class="step-label">Test & Activate</div>
                </div>
            </div>

            <!-- Step 1: Setup -->
            <div id="step1" class="step-content active">
                <h2>Step 1: Setup</h2>
                <p class="text-muted mb-16">Configure your agent's identity and voice</p>

                <div class="form-group">
                    <label>Agent Name</label>
                    <input type="text" id="agentName" placeholder="e.g., Medication Reminder">
                </div>

                <div class="form-group">
                    <label>Description <span class="label-optional">(optional)</span></label>
                    <textarea id="agentDescription" placeholder="Internal note about what this agent does"></textarea>
                </div>

                <div class="form-group">
                    <label>Tone</label>
                    <select id="agentTone">
                        <option value="friendly">Friendly</option>
                        <option value="professional">Professional</option>
                        <option value="empathetic">Empathetic</option>
                        <option value="concise">Concise</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Voice</label>
                    <select id="agentVoice">
                        <option value="female-1">Sarah - Professional Female</option>
                        <option value="female-2">Emma - Warm Female</option>
                        <option value="male-1">James - Professional Male</option>
                        <option value="male-2">David - Friendly Male</option>
                    </select>
                    <div class="voice-preview" onclick="previewVoice()">
                        üîä Preview Voice
                    </div>
                </div>

                <div class="form-group">
                    <label>Speaking Speed</label>
                    <div class="slider-container">
                        <input type="range" id="speakingSpeed" min="0.5" max="2.0" step="0.1" value="1.0" oninput="updateSpeedValue(this.value)">
                        <span class="slider-value" id="speedValue">1.0x</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Audience Source</label>
                    <p class="text-muted mb-16">Choose how users will be fed into this agent</p>

                    <div class="radio-group">
                        <div class="radio-option" onclick="selectAudience('csv')">
                            <input type="radio" name="audience" value="csv">
                            <div class="radio-label">
                                <div class="radio-title">Upload a List</div>
                                <div class="radio-description">Upload a CSV file. System auto-detects column headings as available variables.</div>
                            </div>
                        </div>

                        <div class="radio-option" onclick="selectAudience('program')">
                            <input type="radio" name="audience" value="program">
                            <div class="radio-label">
                                <div class="radio-title">Program-Based</div>
                                <div class="radio-description">Agent runs for users in a specific CMS program. System pulls user profile fields.</div>
                            </div>
                        </div>

                        <div class="radio-option" onclick="selectAudience('api')">
                            <input type="radio" name="audience" value="api">
                            <div class="radio-label">
                                <div class="radio-title">API Trigger</div>
                                <div class="radio-description">External system triggers via webhook. Payload fields become variables.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CSV Upload Area -->
                <div id="csvUploadSection" class="hidden">
                    <div class="csv-upload-area" onclick="document.getElementById('csvFile').click()">
                        <input type="file" id="csvFile" accept=".csv" style="display:none" onchange="handleCSVUpload(this)">
                        <div id="uploadPlaceholder">
                            üìÅ Click to upload CSV file or drag and drop
                        </div>
                        <div id="csvPreview" class="csv-preview hidden">
                            <div id="csvConfirmation" style="color: #10B981; font-weight: 600;"></div>
                        </div>
                    </div>
                </div>

                <!-- Program Selection -->
                <div id="programSection" class="hidden">
                    <div class="form-group">
                        <label>Select Program</label>
                        <select id="programSelect" onchange="handleProgramSelection(this)">
                            <option value="">Choose a program...</option>
                            <option value="diabetes-mgmt">Diabetes Management</option>
                            <option value="hypertension">Hypertension Care</option>
                            <option value="mental-health">Mental Health Support</option>
                        </select>
                    </div>
                    <div id="programConfirmation" class="hidden" style="margin-top: 12px; padding: 12px; background: #ECFDF5; border: 1px solid #10B981; border-radius: 8px; color: #10B981; font-weight: 600;"></div>
                </div>

                <!-- API Schema -->
                <div id="apiSection" class="hidden">
                    <div class="form-group">
                        <label>Webhook URL</label>
                        <input type="text" id="apiEndpoint" value="https://api.lillia.ai/v1/outreach/{agent_id}/trigger" readonly style="background: var(--grey-50); font-family: 'Courier New', monospace; font-size: 13px;">
                        <p class="text-muted" style="margin-top: 8px; font-size: 13px; line-height: 1.5;">Webhook URL generated. Share this with your external system or Journey Module. This endpoint accepts patient data via POST request and triggers the agent for that specific patient.</p>
                    </div>
                </div>

                <div class="btn-container">
                    <button class="btn btn-primary" onclick="nextStep(2)">Next: Prompt</button>
                </div>
            </div>

            <!-- Step 2: Prompt -->
            <div id="step2" class="step-content">
                <h2>Step 2: Prompt</h2>
                <p class="text-muted mb-16">Define what your agent says and knows</p>

                <h3>Select a Template (Optional)</h3>
                <div class="template-grid">
                    <div class="template-card" onclick="selectTemplate('onboarding')">
                        <div class="template-name">Onboarding Call</div>
                        <div class="template-description">Welcome new patients, collect baseline info</div>
                    </div>
                    <div class="template-card" onclick="selectTemplate('medication')">
                        <div class="template-name">Medication Reminder</div>
                        <div class="template-description">Remind patients about medication schedules</div>
                    </div>
                    <div class="template-card" onclick="selectTemplate('feedback')">
                        <div class="template-name">Feedback Collection</div>
                        <div class="template-description">Gather patient experience feedback</div>
                    </div>
                    <div class="template-card" onclick="selectTemplate('appointment')">
                        <div class="template-name">Appointment Reminder</div>
                        <div class="template-description">Confirm upcoming appointments</div>
                    </div>
                    <div class="template-card" onclick="selectTemplate('followup')">
                        <div class="template-name">Follow-Up Check-In</div>
                        <div class="template-description">Post-visit or post-discharge check-in</div>
                    </div>
                </div>

                <div class="ai-generator">
                    <h3>‚ú® AI Prompt Generator</h3>
                    <p style="margin-bottom: 12px; opacity: 0.9;">Describe what you want your agent to do, and AI will generate a complete prompt for you.</p>
                    <textarea id="aiDescription" placeholder="Describe what this agent should do in a few sentences..." maxlength="500"></textarea>
                    <button class="generate-btn" onclick="generatePrompt()">
                        <span>‚ú®</span>
                        <span id="generateBtnText">Generate Prompt</span>
                    </button>
                </div>

                <div class="form-group">
                    <label>Prompt Instructions</label>
                    <textarea id="promptEditor" rows="12" placeholder="Write your agent's instructions here, like you're briefing a human caller..."></textarea>
                </div>

                <div class="kb-section">
                    <h3>Attach Knowledge Base (Optional)</h3>
                    <p class="text-muted mb-16">Reference documents that provide context to the AI during calls</p>

                    <div class="kb-items" id="kbItems">
                        <!-- KB items will appear here -->
                    </div>

                    <button class="upload-btn" onclick="uploadKB()">
                        üìé Upload Document
                    </button>
                </div>

                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevStep(1)">Back</button>
                    <button class="btn btn-primary" onclick="nextStep(3)">Next: Extraction</button>
                </div>
            </div>

            <!-- Step 3: Extraction -->
            <div id="step3" class="step-content">
                <h2>Step 3: Extraction</h2>
                <p class="text-muted mb-16">Define what information to capture from conversations</p>

                <div class="extraction-fields" id="extractionFields">
                    <!-- Sample field -->
                    <div class="extraction-field">
                        <div class="field-header">
                            <span class="field-number">Field 1</span>
                            <button class="remove-field-btn" onclick="removeField(this)">√ó</button>
                        </div>
                        <div class="field-row">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>Field Label</label>
                                <input type="text" placeholder="e.g., Did the patient take their medication?">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>Field Type</label>
                                <select>
                                    <option value="yesno">Yes/No</option>
                                    <option value="text">Text</option>
                                    <option value="number">Number</option>
                                    <option value="date">Date</option>
                                    <option value="select">Single-Select</option>
                                    <option value="multiselect">Multi-Select</option>
                                </select>
                            </div>
                        </div>
                        <div class="field-options">
                            <label class="checkbox-label">
                                <input type="checkbox">
                                <span>Required</span>
                            </label>
                        </div>
                    </div>
                </div>

                <button class="add-field-btn" onclick="addExtractionField()">
                    + Add Field
                </button>

                <div class="rules-section">
                    <h3>Post-Call Actions (Optional)</h3>
                    <p class="text-muted mb-16">Define what happens based on extracted values</p>

                    <div class="rule-card">
                        <div class="rule-row">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>If Field</label>
                                <select>
                                    <option>Select field...</option>
                                    <option>Field 1</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>Equals</label>
                                <input type="text" placeholder="value">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>Then</label>
                                <select>
                                    <option>Escalate to human</option>
                                    <option>Update user profile</option>
                                    <option>Schedule follow-up</option>
                                    <option>Store to document</option>
                                </select>
                            </div>
                            <button class="remove-field-btn">√ó</button>
                        </div>
                    </div>

                    <button class="add-field-btn" onclick="addRule()">
                        + Add Rule
                    </button>
                </div>

                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevStep(2)">Back</button>
                    <button class="btn btn-primary" onclick="nextStep(4)">Next: Test & Activate</button>
                </div>
            </div>

            <!-- Step 4: Test & Activate -->
            <div id="step4" class="step-content">
                <h2>Step 4: Test & Activate</h2>
                <p class="text-muted mb-16">Validate your agent before going live</p>

                <div class="test-section">
                    <h3>Test Call</h3>
                    <p class="text-muted mb-16">Run a test call to your phone number to validate the agent</p>

                    <div class="test-call-box">
                        <div class="form-group" style="margin-bottom: 0; flex: 1;">
                            <label>Your Phone Number</label>
                            <input type="tel" id="testPhone" placeholder="+1 (555) 123-4567">
                        </div>
                        <button class="btn btn-primary" onclick="startTestCall()">
                            üìû Call Me
                        </button>
                    </div>

                    <div id="transcriptBox" class="transcript-box hidden">
                        <h4 style="margin-bottom: 12px; font-size: 15px; font-weight: 600; color: var(--grey-900);">Live Transcript</h4>
                        <div id="transcriptContent">
                            <!-- Transcript will appear here during test call -->
                        </div>
                    </div>
                </div>

                <h3>Validation Checks</h3>
                <div class="validation-checks">
                    <div class="check-item">
                        <span class="check-icon success">‚úì</span>
                        <span>Retell API configured</span>
                    </div>
                    <div class="check-item">
                        <span class="check-icon success">‚úì</span>
                        <span>Prompt is not empty</span>
                    </div>
                    <div class="check-item">
                        <span class="check-icon success">‚úì</span>
                        <span>Audience source is valid</span>
                    </div>
                    <div class="check-item">
                        <span class="check-icon success">‚úì</span>
                        <span>Phone field is present</span>
                    </div>
                    <div class="check-item">
                        <span class="check-icon warning">‚ö†</span>
                        <span>No extraction fields defined (warning only)</span>
                    </div>
                </div>

                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevStep(3)">Back</button>
                    <button class="btn btn-success" onclick="activateAgent()">
                        ‚úì Activate Agent
                    </button>
                </div>
            </div>
        </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentStep = 1;
        let agentData = {
            audienceType: null,
            variables: [],
            selectedTemplate: null,
            kbItems: []
        };

        // Navigation functions
        function startCreation(toolType) {
            if (toolType !== 'voice') return;
            document.getElementById('landingScreen').style.display = 'none';
            document.getElementById('creationFlow').style.display = 'block';
            currentStep = 1;
            updateProgress();
        }

        function closeCreation() {
            document.getElementById('landingScreen').style.display = 'block';
            document.getElementById('creationFlow').style.display = 'none';
            currentStep = 1;
        }

        function nextStep(step) {
            currentStep = step;
            updateProgress();
            showStep(step);
        }

        function prevStep(step) {
            currentStep = step;
            updateProgress();
            showStep(step);
        }

        function showStep(step) {
            document.querySelectorAll('.step-content').forEach(el => {
                el.classList.remove('active');
            });
            document.getElementById('step' + step).classList.add('active');
            window.scrollTo(0, 0);
        }

        function updateProgress() {
            document.querySelectorAll('.progress-step').forEach((el, index) => {
                const stepNum = index + 1;
                el.classList.remove('active', 'completed');

                if (stepNum < currentStep) {
                    el.classList.add('completed');
                } else if (stepNum === currentStep) {
                    el.classList.add('active');
                }
            });
        }

        // Step 1 functions
        function selectAudience(type) {
            agentData.audienceType = type;

            // Update radio selection
            document.querySelectorAll('.radio-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            event.currentTarget.querySelector('input').checked = true;

            // Show/hide relevant sections
            document.getElementById('csvUploadSection').classList.add('hidden');
            document.getElementById('programSection').classList.add('hidden');
            document.getElementById('apiSection').classList.add('hidden');

            if (type === 'csv') {
                document.getElementById('csvUploadSection').classList.remove('hidden');
            } else if (type === 'program') {
                document.getElementById('programSection').classList.remove('hidden');
            } else if (type === 'api') {
                document.getElementById('apiSection').classList.remove('hidden');
            }
        }

        function handleCSVUpload(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];

                // Simulate CSV parsing - count patients
                const patientCount = Math.floor(Math.random() * 200) + 100; // Random count between 100-299

                // Update UI with confirmation message (v6.2: no variables shown)
                document.querySelector('.csv-upload-area').classList.add('has-file');
                document.getElementById('uploadPlaceholder').style.display = 'none';
                document.getElementById('csvPreview').classList.remove('hidden');
                document.getElementById('csvConfirmation').textContent = `${patientCount} patients found. Phone numbers detected.`;
            }
        }

        function handleProgramSelection(select) {
            const programValue = select.value;
            const confirmationDiv = document.getElementById('programConfirmation');

            if (programValue) {
                // Simulate program data lookup with patient counts
                const programData = {
                    'diabetes-mgmt': { name: 'Diabetes Management', count: 312 },
                    'hypertension': { name: 'Hypertension Care', count: 185 },
                    'mental-health': { name: 'Mental Health Support', count: 97 }
                };

                const program = programData[programValue];
                confirmationDiv.textContent = `${program.name} ‚Äî ${program.count} active patients.`;
                confirmationDiv.classList.remove('hidden');
            } else {
                confirmationDiv.classList.add('hidden');
            }
        }

        function updateSpeedValue(value) {
            document.getElementById('speedValue').textContent = value + 'x';
        }

        function previewVoice() {
            alert('üîä Voice preview would play here');
        }

        // Step 2 functions
        function selectTemplate(templateId) {
            agentData.selectedTemplate = templateId;

            // Update selection
            document.querySelectorAll('.template-card').forEach(el => {
                el.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');

            // Load template content
            const templates = {
                'onboarding': 'You are a friendly healthcare agent calling to welcome a new patient to the program. Start by introducing yourself and confirming their identity using patient_name. Explain the purpose of the call and collect baseline health information. Be warm and encouraging.',
                'medication': 'You are calling to remind the patient about their medication schedule. Greet them using patient_name and ask if they have taken their medication_name at medication_time. If they haven\'t, gently ask about any barriers they\'re facing. If they mention side effects or distress, mark for escalation.',
                'feedback': 'You are calling to collect feedback about the patient\'s recent healthcare experience. Be friendly and thank them for their time. Ask about their satisfaction with the service, any concerns they have, and what could be improved. If they mention a complaint, escalate appropriately.',
                'appointment': 'You are calling to confirm an upcoming appointment. Verify the patient\'s identity using patient_name, remind them of their appointment date and time, and ask if they can still make it. If they need to reschedule or cancel, collect that information for follow-up.',
                'followup': 'You are conducting a post-visit check-in call. Ask the patient how they\'re feeling since their last visit, whether they\'re following their care plan, and if they have any concerns. Be empathetic and listen for any red flags that might require escalation.'
            };

            document.getElementById('promptEditor').value = templates[templateId] || '';
        }

        function generatePrompt() {
            const description = document.getElementById('aiDescription').value.trim();
            if (!description) {
                alert('Please enter a description of what you want your agent to do');
                return;
            }

            // Show loading state
            const btn = document.querySelector('.generate-btn');
            const btnText = document.getElementById('generateBtnText');
            btnText.textContent = 'Generating...';
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div><span>Generating...</span>';

            // Simulate AI generation
            setTimeout(() => {
                const generatedPrompt = `You are a professional healthcare agent making an outbound call. Your role is to ${description}

Key Instructions:
1. Always greet the patient warmly and verify their identity by name before proceeding
2. Speak in a ${document.getElementById('agentTone').value} tone throughout the conversation
3. Listen carefully to the patient's responses and adapt your approach accordingly
4. If the patient expresses distress, side effects, or urgent concerns, acknowledge them empathetically and note for escalation
5. Keep the conversation focused but allow the patient to express themselves fully
6. End the call by thanking them for their time and clearly summarizing next steps

Your goal is to complete this call efficiently while being empathetic and helpful.`;

                document.getElementById('promptEditor').value = generatedPrompt;

                // Reset button
                btn.disabled = false;
                btn.innerHTML = '<span>‚ú®</span><span id="generateBtnText">Generate Prompt</span>';
            }, 2000);
        }

        function uploadKB() {
            const kbItems = document.getElementById('kbItems');
            const newItem = document.createElement('div');
            newItem.className = 'kb-item';
            newItem.innerHTML = `
                <span>üìÑ Sample_Guidelines.pdf</span>
                <button class="action-btn" onclick="this.parentElement.remove()">Remove</button>
            `;
            kbItems.appendChild(newItem);
        }

        // Step 3 functions
        function addExtractionField() {
            const container = document.getElementById('extractionFields');
            const fieldNumber = container.children.length + 1;

            const field = document.createElement('div');
            field.className = 'extraction-field';
            field.innerHTML = `
                <div class="field-header">
                    <span class="field-number">Field ${fieldNumber}</span>
                    <button class="remove-field-btn" onclick="removeField(this)">√ó</button>
                </div>
                <div class="field-row">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Field Label</label>
                        <input type="text" placeholder="e.g., Did the patient take their medication?">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Field Type</label>
                        <select>
                            <option value="yesno">Yes/No</option>
                            <option value="text">Text</option>
                            <option value="number">Number</option>
                            <option value="date">Date</option>
                            <option value="select">Single-Select</option>
                            <option value="multiselect">Multi-Select</option>
                        </select>
                    </div>
                </div>
                <div class="field-options">
                    <label class="checkbox-label">
                        <input type="checkbox">
                        <span>Required</span>
                    </label>
                </div>
            `;
            container.appendChild(field);
        }

        function removeField(btn) {
            btn.closest('.extraction-field').remove();
            // Renumber remaining fields
            document.querySelectorAll('.extraction-field').forEach((field, index) => {
                field.querySelector('.field-number').textContent = `Field ${index + 1}`;
            });
        }

        function addRule() {
            alert('Add rule functionality would be implemented here');
        }

        // Step 4 functions
        function startTestCall() {
            const phone = document.getElementById('testPhone').value;
            if (!phone) {
                alert('Please enter your phone number');
                return;
            }

            // Show transcript box and clear previous content
            const transcriptBox = document.getElementById('transcriptBox');
            const transcriptContent = document.getElementById('transcriptContent');
            transcriptBox.classList.remove('hidden');
            transcriptContent.innerHTML = '<div style="color: var(--grey-600); font-style: italic;">Initiating call...</div>';

            // Simulate live transcript updates
            setTimeout(() => {
                transcriptContent.innerHTML = `
                    <div class="transcript-entry">
                        <div class="speaker agent">Agent:</div>
                        <div>Hello! This is a medication reminder call from your healthcare provider. Am I speaking with John?</div>
                    </div>
                `;
            }, 2000);

            setTimeout(() => {
                transcriptContent.innerHTML += `
                    <div class="transcript-entry">
                        <div class="speaker user">User:</div>
                        <div>Yes, this is John.</div>
                    </div>
                `;
                transcriptBox.scrollTop = transcriptBox.scrollHeight;
            }, 4000);

            setTimeout(() => {
                transcriptContent.innerHTML += `
                    <div class="transcript-entry">
                        <div class="speaker agent">Agent:</div>
                        <div>Great! I'm calling to remind you about your diabetes medication. Have you taken your morning dose today?</div>
                    </div>
                `;
                transcriptBox.scrollTop = transcriptBox.scrollHeight;
            }, 6000);

            setTimeout(() => {
                transcriptContent.innerHTML += `
                    <div class="transcript-entry">
                        <div class="speaker user">User:</div>
                        <div>No, I haven't taken it yet. I've been feeling a bit nauseous.</div>
                    </div>
                `;
                transcriptBox.scrollTop = transcriptBox.scrollHeight;
            }, 8000);

            setTimeout(() => {
                transcriptContent.innerHTML += `
                    <div class="transcript-entry">
                        <div class="speaker agent">Agent:</div>
                        <div>I understand. Nausea can be uncomfortable. Have you experienced this side effect before, or is this new?</div>
                    </div>
                `;
                transcriptBox.scrollTop = transcriptBox.scrollHeight;
            }, 10000);

            setTimeout(() => {
                transcriptContent.innerHTML += `
                    <div class="transcript-entry">
                        <div class="speaker user">User:</div>
                        <div>It started a few days ago. It's making it hard to take my medication on time.</div>
                    </div>
                `;
                transcriptBox.scrollTop = transcriptBox.scrollHeight;
            }, 12000);

            setTimeout(() => {
                transcriptContent.innerHTML += `
                    <div class="transcript-entry">
                        <div class="speaker agent">Agent:</div>
                        <div>Thank you for sharing that, John. This is important information. I'm going to note this for your care provider to follow up with you. In the meantime, please try to take your medication if possible. Is there anything else you'd like me to know?</div>
                    </div>
                `;
                transcriptBox.scrollTop = transcriptBox.scrollHeight;
            }, 14000);

            setTimeout(() => {
                transcriptContent.innerHTML += `
                    <div class="transcript-entry">
                        <div class="speaker user">User:</div>
                        <div>No, that's all. Thank you.</div>
                    </div>
                `;
                transcriptBox.scrollTop = transcriptBox.scrollHeight;
            }, 16000);

            setTimeout(() => {
                transcriptContent.innerHTML += `
                    <div class="transcript-entry">
                        <div class="speaker agent">Agent:</div>
                        <div>You're welcome, John. Take care, and someone from your care team will reach out soon about the nausea. Goodbye!</div>
                    </div>
                    <div style="margin-top: 16px; padding: 12px; background: #ECFDF5; border-radius: 8px; border: 1px solid #10B981;">
                        <div style="font-weight: 600; color: #10B981; margin-bottom: 8px;">‚úì Call Completed ‚Äî Extraction Results:</div>
                        <div style="font-size: 13px; color: var(--grey-700); line-height: 1.6;">
                            <div style="margin-bottom: 6px;"><strong>Medication Taken:</strong> No</div>
                            <div style="margin-bottom: 6px;"><strong>Barriers Mentioned:</strong> Nausea, difficulty taking medication on time</div>
                            <div style="margin-bottom: 6px;"><strong>Escalation Required:</strong> Yes (Side effect reported)</div>
                        </div>
                    </div>
                `;
                transcriptBox.scrollTop = transcriptBox.scrollHeight;
            }, 18000);
        }

        function activateAgent() {
            const agentName = document.getElementById('agentName').value;
            if (!agentName) {
                alert('Please go back and enter an agent name');
                return;
            }

            alert(`Agent "${agentName}" has been activated successfully!`);
            closeCreation();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Outreach Module v6 initialized');
        });
    </script>
</body>
</html>
